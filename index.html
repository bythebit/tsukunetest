<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-YWQJNGXJDP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-YWQJNGXJDP');
</script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- ğŸŸ¢ [SEO] ì‚¬ì´íŠ¸ ì„¤ëª… ë³´ê°• -->
    <meta name="description" content="Tsukune - AI Japanese Menu Translator. ì¼ë³¸ ì—¬í–‰ í•„ìˆ˜ ì•±! ë¶“ê¸€ì”¨ ë©”ë‰´íŒ ë²ˆì—­ë¶€í„° ì´ìì¹´ì•¼ ì£¼ë¬¸ ê¿€íŒ, AI ë©”ë‰´ ì¶”ì²œê¹Œì§€. ì½ê¸° í˜ë“  ì¼ë³¸ì–´ ë©”ë‰´íŒì„ í•œ ë²ˆì— í•´ê²°í•˜ì„¸ìš”.">
    <meta name="keywords" content="ì¼ë³¸ì–´ ë©”ë‰´íŒ ë²ˆì—­, ì¼ë³¸ ì—¬í–‰ ë²ˆì—­, ì´ìì¹´ì•¼ ë©”ë‰´ ì¶”ì²œ, ì•¼í‚¤í† ë¦¬ ì£¼ë¬¸ë²•, ì˜¤í† ì‹œ ëœ», ë…¸ë¯¸í˜¸ë‹¤ì´, ì¸ ì¿ ë„¤">
    <meta name="author" content="Tsukune">
    <meta property="og:title" content="Tsukune - ì¼ë³¸ì–´ ë©”ë‰´íŒì˜ ëª¨ë“  ê²ƒ">
    
    <!-- ğŸŸ¢ [Google AdSense] ì†Œìœ ê¶Œ í™•ì¸ìš© ë©”íƒ€ íƒœê·¸ (í•„ìˆ˜ ìœ ì§€) -->
    <meta name="google-adsense-account" content="ca-pub-3978570243079752">
    
    <title>Tsukune - AI Menu Translator & Guide</title>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Pen+Script&family=Noto+Sans+JP:wght@400;700&family=Noto+Sans+KR:wght@400;700&family=Patrick+Hand&display=swap" rel="stylesheet">
    
    <!-- ğŸŸ¢ [Google AdSense] ê´‘ê³  ìŠ¤í¬ë¦½íŠ¸ (í•„ìˆ˜ ìœ ì§€) -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3978570243079752"
      crossorigin="anonymous"></script>

    <style>
        /* ğŸ¨ í…Œë§ˆ: ì‹¬ì•¼ì‹ë‹¹ */
        :root {
            --bg-color: #2c241b;
            --card-bg: #f4ecd8;
            --text-color: #3e3226;
            --accent-color: #d97d54;
            --title-color: #ffffff;
            --wood-frame: #6d543e;
            --footer-text: #a89f91;
            --btn-inactive: #4a3b2f;
        }

        body { 
            font-family: 'Noto Sans KR', sans-serif; 
            background-color: var(--bg-color); 
            margin: 0; padding: 0;
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* ğŸŒ ì–¸ì–´ ìŠ¤ìœ„ì¹˜ ìŠ¤íƒ€ì¼ */
        .lang-switch {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0 30px 0;
            z-index: 100;
        }
        .lang-btn {
            background: rgba(0,0,0,0.3);
            border: 1px solid #554b41;
            color: #aaa;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .lang-btn.active {
            background: var(--accent-color);
            color: white;
            font-weight: bold;
            border-color: var(--accent-color);
        }

        /* êµ¬ì¡°ì  ë ˆì´ì•„ì›ƒ */
        header, main, footer { width: 100%; max-width: 600px; padding: 10px 20px; box-sizing: border-box; }
        
        header { margin-top: 20px; text-align: center; position: relative; }

        h1 { 
            font-family: 'Nanum Pen Script', 'Patrick Hand', cursive; 
            font-size: 60px; 
            color: var(--title-color); 
            margin: 0; line-height: 1.0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        p.sub { 
            font-family: 'Nanum Pen Script', 'Patrick Hand', cursive; 
            font-size: 30px; 
            color: #ddd; 
            margin-top: 5px; 
            letter-spacing: 1px; 
        }

        .header-area { 
            margin-top: 60px;    
            margin-bottom: 0px; 
        }

        .container-width {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .btn-label {
            display: flex; align-items: center; justify-content: center;
            width: 100%; max-width: 300px; padding: 20px 0;
            border-radius: 12px;
            font-size: 20px; font-weight: bold; cursor: pointer;
            transition: transform 0.1s;
            box-shadow: 0 6px 15px rgba(0,0,0,0.4);
            background-color: var(--accent-color); 
            color: white; border: none;
        }
        .btn-label:active { transform: scale(0.98); }
        
        input[type="file"] { display: none; }

        #preview-container { display: none; margin: 20px auto; max-width: 300px; }
        .preview-frame {
            border: 4px solid var(--wood-frame);
            background-color: var(--wood-frame);
            padding: 2px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            border-radius: 2px;
        }
        #preview-img { width: 100%; height: auto; display: block; max-height: 350px; object-fit: contain; background-color: #eee; border-radius: 1px; }

        #loading { display: none; margin-top: 30px; color: white; font-size: 18px; text-align: center; }
        .spinner { font-size: 40px; margin-bottom: 10px; display: block; animation: spin 2s infinite linear; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        #resultArea { margin-top: 20px; text-align: left; width: 100%; }
        
        .category-header {
            font-family: 'Nanum Pen Script', 'Patrick Hand', cursive;
            font-size: 32px;
            color: var(--accent-color);
            margin: 40px 0 15px 5px;
            border-bottom: 2px solid #554b41;
            padding-bottom: 5px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 2px; padding: 20px; margin-bottom: 15px;
            position: relative; box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            background-image: linear-gradient(#e8e0cc 1px, transparent 1px);
            background-size: 100% 1.5em;
        }
        
        .card-top { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
        .menu-tr { font-size: 20px; font-weight: 800; color: #222; margin-bottom: 4px; line-height: 1.3; }
        .menu-jp { font-family: 'Noto Sans JP', sans-serif; font-size: 20px; font-weight: 500; color: #555; margin-bottom: 10px; }
        .price-badge { background-color: #3e3226; color: #fff; padding: 4px 8px; border-radius: 4px; font-weight: bold; font-size: 16px; white-space: nowrap; }
        .desc { font-size: 15px; color: #666; margin-bottom: 12px; line-height: 1.4; border-top: 1px dashed #ccc; padding-top: 8px; }
        
        .voice-btn {
            width: 100%; background: #ffffff; border: 1px solid #d97d54; 
            padding: 12px; border-radius: 8px; 
            font-size: 16px; color: #d97d54; font-weight: bold; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); transition: 0.2s;
        }
        .voice-btn:active { background: #fff5f0; transform: scale(0.98); }

        #recommendBtn {
            display: none;
            width: 100%;
            background: linear-gradient(135deg, #d97d54 0%, #ff9a76 100%);
            color: white;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 30px;
            box-shadow: 0 4px 15px rgba(217, 125, 84, 0.4);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(217, 125, 84, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(217, 125, 84, 0); }
            100% { box-shadow: 0 0 0 0 rgba(217, 125, 84, 0); }
        }

        #recommendationArea {
            display: none;
            margin-top: 20px;
            background-color: #fff;
            border: 2px solid #d97d54;
            border-radius: 16px;
            padding: 30px 20px 20px 20px;
            position: relative;
        }
        #recommendationArea::before {
            content: attr(data-label);
            position: absolute;
            top: -15px;
            left: 20px;
            background-color: #d97d54;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }
        .rec-text {
            font-family: 'Nanum Pen Script', 'Patrick Hand', cursive;
            font-size: 27px;
            line-height: 1.6;
            color: #3e3226;
            white-space: pre-wrap;
            word-break: keep-all;
        }

        /* ğŸŸ¢ [UI ê°œì„ ] ì •ë³´ íƒ­ ë„¤ë¹„ê²Œì´ì…˜ ìŠ¤íƒ€ì¼ */
        .info-nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 30px;
            margin-bottom: 20px;
            width: 100%;
        }
        .info-tab-btn {
            flex: 1;
            padding: 12px 5px;
            background-color: var(--btn-inactive);
            color: #ccc;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 3px 6px rgba(0,0,0,0.3);
        }
        .info-tab-btn.active {
            background-color: var(--accent-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.4);
        }
        .info-tab-btn:hover {
            filter: brightness(1.1);
        }

        /* ğŸŸ¢ [UI ê°œì„ ] íƒ­ ì½˜í…ì¸  ì˜ì—­ ìŠ¤íƒ€ì¼ */
        .info-content {
            display: none; /* ê¸°ë³¸ ìˆ¨ê¹€ */
            background-color: #3e3226;
            padding: 25px;
            border-radius: 16px;
            color: #f4ecd8;
            text-align: center;
            border: 2px solid #554b41;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.3);
            animation: fadeIn 0.3s ease-in-out;
        }
        .info-content.active {
            display: block; /* í™œì„±í™” ì‹œ ë³´ì„ */
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ê°€ì´ë“œ ë‚´ë¶€ ìŠ¤íƒ€ì¼ */
        .guide-intro h2 { color: var(--accent-color); font-size: 22px; margin-bottom: 10px; text-shadow: 1px 1px 0 #000; }
        .guide-intro p { font-size: 14px; opacity: 0.8; margin-bottom: 20px; }
        
        .steps-grid { display: flex; justify-content: center; align-items: center; gap: 8px; margin-bottom: 20px; }
        .step-card { background-color: #2c241b; padding: 12px 8px; border-radius: 10px; width: 80px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); border: 1px solid #554b41; }
        .step-icon { font-size: 24px; margin-bottom: 5px; }
        .step-text { font-size: 11px; line-height: 1.3; color: #ddd; }
        .step-text strong { color: #fff; font-size: 12px; }
        .step-arrow { color: #6d543e; font-weight: bold; }

        .scenario-tags { display: flex; flex-wrap: wrap; justify-content: center; gap: 6px; margin-bottom: 15px; }
        .tag { background-color: #554b41; color: #e8e0cc; padding: 5px 10px; border-radius: 15px; font-size: 12px; font-weight: bold; }
        .tip-text { font-size: 12px; color: #aaa; background-color: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px; display: inline-block; }

        /* íŒ & FAQ ìŠ¤íƒ€ì¼ */
        .tip-box, .faq-item { margin-bottom: 15px; text-align: left; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; }
        .tip-box h4, .faq-q { color: var(--accent-color); font-weight: bold; font-size: 15px; margin: 0 0 5px 0; }
        .tip-box p, .faq-a { font-size: 13px; color: #ccc; line-height: 1.5; margin: 0; }

        footer {
            margin-top: auto;
            border-top: 1px solid #444;
            padding-top: 20px;
            text-align: center;
            color: var(--footer-text);
            font-size: 12px;
        }
        footer a { color: var(--footer-text); text-decoration: none; margin: 0 5px; cursor: pointer; }
        footer a:hover { color: var(--accent-color); }

        .modal {
            display: none;
            position: fixed; z-index: 1000;
            left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.8);
            align-items: center; justify-content: center;
        }
        .modal-content {
            background-color: #f4ecd8;
            color: #3e3226;
            padding: 25px;
            border-radius: 8px;
            width: 90%; max-width: 500px;
            max-height: 80vh; overflow-y: auto;
            text-align: left;
            position: relative;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            font-family: 'Noto Sans KR', sans-serif;
        }
        .modal-content h2 { margin-top: 0; color: #d97d54; font-family: 'Nanum Pen Script', 'Patrick Hand', cursive; font-size: 30px; }
        .modal-content p { font-size: 14px; line-height: 1.6; color: #555; }
        .modal-content h3 { font-size: 16px; margin-top: 20px; margin-bottom: 5px; color: #2c241b; }
        .close-btn {
            position: absolute; top: 15px; right: 20px;
            color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer;
        }
        .close-btn:hover { color: #d97d54; }
    </style>
</head>
<body>

    <header class="header-area">
        <h1 id="txt-title">ì¸ ì¿ ë„¤</h1>
        <p class="sub" id="txt-subtitle">ì¼ë³¸ì–´ ë©”ë‰´íŒ ì™„ì „ ì •ë³µ</p>
    </header>

    <!-- ğŸŒ ì–¸ì–´ ìŠ¤ìœ„ì¹˜ -->
    <div class="lang-switch">
        <div class="lang-btn active" id="btn-ko" onclick="setLanguage('ko')">ğŸ‡°ğŸ‡· KR</div>
        <div class="lang-btn" id="btn-en" onclick="setLanguage('en')">ğŸ‡ºğŸ‡¸ EN</div>
    </div>

    <main>
        <div class="container-width">
            <label for="fileInput" class="btn-label" id="txt-uploadBtn">
                ğŸ“‹ï¸ ë©”ë‰´íŒ ì—…ë¡œë“œ
            </label>
            <input type="file" id="fileInput" accept="image/*">
        </div>

        <div id="preview-container">
            <div class="preview-frame">
                <img id="preview-img" src="" alt="ë©”ë‰´íŒ ë¯¸ë¦¬ë³´ê¸°">
            </div>
        </div>

        <div id="loading">
            <span class="spinner">ğŸ¢</span>
            <br><span id="txt-loading">ì¸ ì¿ ë„¤ê°€ ë©”ë‰´ë¥¼ ë²ˆì—­ ì¤‘ì…ë‹ˆë‹¤...</span>
        </div>

        <div id="resultArea"></div>

        <!-- âœ¨ AI ì¶”ì²œ ë²„íŠ¼ -->
        <button id="recommendBtn" onclick="getRecommendation()">
            <!-- JSì—ì„œ í…ìŠ¤íŠ¸ ì„¤ì • -->
        </button>

        <!-- âœ¨ AI ì¶”ì²œ ê²°ê³¼ ì˜ì—­ -->
        <div id="recommendationArea" data-label="ë§ˆìŠ¤í„°ì˜ í•œë§ˆë””">
            <div id="recContent" class="rec-text"></div>
        </div>

        <!-- ğŸŸ¢ ì •ë³´ íƒ­ ë„¤ë¹„ê²Œì´ì…˜ (UI ê°œì„ ) -->
        <div id="infoNav" class="info-nav">
            <button class="info-tab-btn active" onclick="switchTab('guide')" id="nav-guide">ğŸ“– ì´ìš© ë°©ë²•</button>
            <button class="info-tab-btn" onclick="switchTab('tips')" id="nav-tips">ğŸ® ê¿€íŒ</button>
            <button class="info-tab-btn" onclick="switchTab('faq')" id="nav-faq">â“ FAQ</button>
        </div>

        <!-- ğŸŸ¢ íƒ­ 1: ì´ìš© ë°©ë²• -->
        <div id="tab-guide" class="info-content active">
            <div class="guide-intro">
                <h2 id="txt-guideTitle">ğŸ‡¯ğŸ‡µ ì¼ë³¸ì–´ ë©”ë‰´íŒ, ì«„ì§€ ë§ˆì„¸ìš”!</h2>
                <p id="txt-guideDesc">ì¸ ì¿ ë„¤ê°€ ë‹¹ì‹ ì˜ <strong>ê°œì¸ í†µì—­ì‚¬</strong>ê°€ ë˜ì–´ë“œë¦½ë‹ˆë‹¤.</p>
            </div>
            <div class="steps-grid">
                <div class="step-card">
                    <div class="step-icon">ğŸ“¸</div>
                    <div class="step-text" id="txt-step1"><strong>1. ì°°ì¹µ!</strong><br>ë©”ë‰´íŒ ì°ê¸°</div>
                </div>
                <div class="step-arrow">â¤</div>
                <div class="step-card">
                    <div class="step-icon">ğŸ¤–</div>
                    <div class="step-text" id="txt-step2"><strong>2. ìœ„ì‰~</strong><br>ë²ˆì—­</div>
                </div>
                <div class="step-arrow">â¤</div>
                <div class="step-card">
                    <div class="step-icon">ğŸ—£ï¸</div>
                    <div class="step-text" id="txt-step3"><strong>3. "ì£¼ë¬¸!"</strong><br>ì£¼ë¬¸ ì™„ë£Œ</div>
                </div>
            </div>
            <div class="scenario-tags" id="txt-scenarioTags">
                <!-- JSë¡œ íƒœê·¸ ìƒì„± -->
            </div>
            <p class="tip-text" id="txt-tip">
                ë¶“ê¸€ì”¨, ì„¸ë¡œì“°ê¸° ë©”ë‰´íŒë„ ë¬¸ì œ ì—†ì–´ìš”!<br>
                ì¸ ì¿ ë„¤ê°€ ê·€ì‹ ê°™ì´ ì½ì–´ëƒ…ë‹ˆë‹¤. ğŸ‘»
            </p>
        </div>

        <!-- ğŸŸ¢ íƒ­ 2: ì´ìì¹´ì•¼ ê¿€íŒ -->
        <div id="tab-tips" class="info-content">
            <div id="tips-content">
                <!-- JSë¡œ ì£¼ì… -->
            </div>
        </div>

        <!-- ğŸŸ¢ íƒ­ 3: FAQ -->
        <div id="tab-faq" class="info-content">
            <div id="faq-content">
                <!-- JSë¡œ ì£¼ì… -->
            </div>
        </div>

    </main>

    <footer>
        <p id="txt-footerRights">&copy; 2026 Tsukune Menu Translator. All rights reserved.</p>
        <p>
            <a onclick="openModal('termsModal')" id="txt-termsBtn">ì´ìš©ì•½ê´€</a> | 
            <a onclick="openModal('privacyModal')" id="txt-privacyBtn">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a> | 
            <a href="mailto:support@example.com" id="txt-inquiryBtn">ë¬¸ì˜í•˜ê¸°</a>
        </p>
        <p style="font-size: 10px; color: #555; margin-top: 10px;" id="txt-footerNote">
            This site uses Gemini API for translation. <br>
            Translation results may vary depending on image quality.
        </p>
    </footer>

    <!-- ì´ìš©ì•½ê´€ ëª¨ë‹¬ -->
    <div id="termsModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('termsModal')">&times;</span>
            <h2 id="modal-terms-title">ì´ìš©ì•½ê´€</h2>
            <div id="modal-terms-content">
                <!-- JSë¡œ ì£¼ì… -->
            </div>
        </div>
    </div>

    <!-- ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ ëª¨ë‹¬ -->
    <div id="privacyModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('privacyModal')">&times;</span>
            <h2 id="modal-privacy-title">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</h2>
            <div id="modal-privacy-content">
                <!-- JSë¡œ ì£¼ì… -->
            </div>
        </div>
    </div>

    <script>
        // ğŸ”´ [ì²´í¬í¬ì¸íŠ¸] Worker ì£¼ì†Œ (https://...workers.dev)
        const AI_PROXY_URL = "https://tsukune-ai-proxy.danieltaeyoon.workers.dev/";

        // ğŸ”¥ [ì¡±ë³´] ë‹¤êµ­ì–´ ì§€ì›ì„ ìœ„í•œ ë”•ì…”ë„ˆë¦¬
        const translations = {
            ko: {
                title: "ì¸ ì¿ ë„¤",
                subtitle: "ì¼ë³¸ì–´ ë©”ë‰´íŒ ì™„ì „ ì •ë³µ",
                uploadBtn: "ğŸ“‹ï¸ ë©”ë‰´íŒ ì—…ë¡œë“œ",
                loading: "ì¸ ì¿ ë„¤ê°€ ë©”ë‰´ë¥¼ ë²ˆì—­ ì¤‘ì…ë‹ˆë‹¤...",
                recBtn: "ğŸ¶ ë§ˆìŠ¤í„°ì—ê²Œ ì¶”ì²œë°›ê¸° âœ¨",
                recBtnLoading: "ğŸ¤” ë§ˆìŠ¤í„°ê°€ ê³ ë¯¼ ì¤‘ì…ë‹ˆë‹¤...",
                recBtnRetry: "ğŸ¶ ë‹¤ë¥¸ ì¶”ì²œ ë°›ê¸°",
                masterTitle: "ğŸ¶ ë§ˆìŠ¤í„°ì˜ í•œë§ˆë””",
                guideTitle: "ì¼ë³¸ì–´ ë©”ë‰´íŒ, ì«„ì§€ ë§ˆì„¸ìš”!",
                guideDesc: "ì¸ ì¿ ë„¤ê°€ ë‹¹ì‹ ì˜ <strong>ê°œì¸ í†µì—­ì‚¬</strong>ê°€ ë˜ì–´ë“œë¦½ë‹ˆë‹¤.",
                step1: "<strong>1. ì°°ì¹µ!</strong><br>ë©”ë‰´íŒ ì°ê¸°",
                step2: "<strong>2. ìœ„ì‰~</strong><br>ë²ˆì—­",
                step3: "<strong>3. \ì£¼ë¬¸!\</strong><br>ì£¼ë¬¸ ì™„ë£Œ",
                scenarioTags: ["ğŸ® ë¡œì»¬ ì´ìì¹´ì•¼", "ğŸ¢ ì•¼í‚¤í† ë¦¬ ì „ë¬¸ì ", "ğŸ£ ì˜¤ë§ˆì¹´ì„¸ ì½”ìŠ¤", "ğŸº ë…¸ë¯¸í˜¸ë‹¤ì´"],
                tip: "ë¶“ê¸€ì”¨, ì„¸ë¡œì“°ê¸° ë©”ë‰´íŒë„ ë¬¸ì œ ì—†ì–´ìš”!<br>ì¸ ì¿ ë„¤ê°€ ê·€ì‹ ê°™ì´ ì½ì–´ëƒ…ë‹ˆë‹¤. ğŸ‘»",
                navGuide: "ğŸ“– ì´ìš© ë°©ë²•",
                navTips: "ğŸ® ê¿€íŒ",
                navFaq: "â“ FAQ",
                tipsContent: `
                    <div class="tip-box">
                        <h4>1. ì˜¤í† ì‹œ(ãŠé€šã—)ë€?</h4>
                        <p>ì¼ë³¸ ìˆ ì§‘ì˜ ìë¦¿ì„¸ ê°œë…ìœ¼ë¡œ ë‚˜ì˜¤ëŠ” ê¸°ë³¸ ì•ˆì£¼ì…ë‹ˆë‹¤. ê±°ì ˆí•˜ê¸° ì–´ë ¤ìš´ ê²½ìš°ê°€ ë§ìœ¼ë‹ˆ ë‹¹í™©í•˜ì§€ ë§ˆì„¸ìš”!</p>
                    </div>
                    <div class="tip-box">
                        <h4>2. íƒ€ë ˆ(ã‚¿ãƒ¬) vs ì‹œì˜¤(å¡©)</h4>
                        <p>ê¼¬ì¹˜êµ¬ì´(ì•¼í‚¤í† ë¦¬)ë¥¼ ì‹œí‚¬ ë•Œ ì†ŒìŠ¤ë¥¼ ê³ ë¥´ë¼ê³  í•©ë‹ˆë‹¤. ë‹¬ì§ì§€ê·¼í•œ ê°„ì¥ ì–‘ë…ì€ 'íƒ€ë ˆ', ë‹´ë°±í•œ ì†Œê¸ˆêµ¬ì´ëŠ” 'ì‹œì˜¤'ì…ë‹ˆë‹¤.</p>
                    </div>
                    <div class="tip-box">
                        <h4>3. ë…¸ë¯¸í˜¸ë‹¤ì´(é£²ã¿æ”¾é¡Œ)</h4>
                        <p>ìˆ ì„ ì¢‹ì•„í•˜ì‹ ë‹¤ë©´ ì´ ê¸€ìë¥¼ ì°¾ìœ¼ì„¸ìš”! ì •í•´ì§„ ì‹œê°„ ë™ì•ˆ ìˆ ì„ ë¬´ì œí•œìœ¼ë¡œ ë§ˆì‹¤ ìˆ˜ ìˆëŠ” ê°€ì„±ë¹„ ì½”ìŠ¤ì…ë‹ˆë‹¤.</p>
                    </div>
                `,
                faqContent: `
                    <div class="faq-item">
                        <div class="faq-q">Q. ì¸ ì¿ ë„¤ëŠ” ì–´ë–¤ ì„œë¹„ìŠ¤ì¸ê°€ìš”?</div>
                        <div class="faq-a">A. ì—¬í–‰ ì¤‘ ì½ê¸° í˜ë“  ì¼ë³¸ì–´ ë©”ë‰´íŒì„ ì‚¬ì§„ìœ¼ë¡œ ì°ìœ¼ë©´, AIê°€ ë©”ë‰´ëª…, ê°€ê²©, ì„¤ëª…ì„ ìë™ìœ¼ë¡œ ë²ˆì—­í•´ì£¼ê³  ë°œìŒê¹Œì§€ ì•Œë ¤ì£¼ëŠ” ë¬´ë£Œ ì›¹ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.</div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-q">Q. ë¶“ê¸€ì”¨ë‚˜ ì„¸ë¡œì“°ê¸°ë„ ì¸ì‹í•˜ë‚˜ìš”?</div>
                        <div class="faq-a">A. ë„¤, ìµœì‹  AI ê¸°ìˆ (Gemini)ì„ í™œìš©í•˜ì—¬ ì†ê¸€ì”¨ë‚˜ ì„¸ë¡œë¡œ ì“°ì¸ ì „í†µ ë©”ë‰´íŒë„ ë†’ì€ ì •í™•ë„ë¡œ ì¸ì‹í•©ë‹ˆë‹¤.</div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-q">Q. ì°ì€ ì‚¬ì§„ì€ ì €ì¥ë˜ë‚˜ìš”?</div>
                        <div class="faq-a">A. ì•„ë‹ˆìš”, ì—…ë¡œë“œí•œ ì´ë¯¸ì§€ëŠ” ì˜¤ì§ ë²ˆì—­ ë¶„ì„ì„ ìœ„í•´ì„œë§Œ ì¼ì‹œì ìœ¼ë¡œ ì‚¬ìš©ë˜ë©°, ì„œë²„ì— ì €ì¥ë˜ì§€ ì•Šê³  ì¦‰ì‹œ íê¸°ë©ë‹ˆë‹¤. ì•ˆì‹¬í•˜ê³  ì‚¬ìš©í•˜ì„¸ìš”.</div>
                    </div>
                `,
                footerRights: "&copy; 2026 Tsukune Menu Translator. All rights reserved.",
                footerNote: "This site uses Gemini API for translation. <br>Translation results may vary depending on image quality.",
                termsBtn: "ì´ìš©ì•½ê´€",
                privacyBtn: "ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨",
                inquiryBtn: "ë¬¸ì˜í•˜ê¸°",
                termsTitle: "ì´ìš©ì•½ê´€",
                termsContent: `
                    <p><strong>ì œ1ì¡° (ëª©ì )</strong><br>ë³¸ ì•½ê´€ì€ 'ì¸ ì¿ ë„¤'(ì´í•˜ "ì„œë¹„ìŠ¤")ê°€ ì œê³µí•˜ëŠ” ì¼ë³¸ì–´ ë©”ë‰´íŒ ë²ˆì—­ ì„œë¹„ìŠ¤ì˜ ì´ìš© ì¡°ê±´ì„ ê·œì •í•©ë‹ˆë‹¤.</p>
                    <p><strong>ì œ2ì¡° (ì„œë¹„ìŠ¤ì˜ ì„±ê²©)</strong><br>ë³¸ ì„œë¹„ìŠ¤ëŠ” AI ê¸°ìˆ (Google Gemini API)ì„ í™œìš©í•œ ë‹¨ìˆœ ë²ˆì—­ ë„êµ¬ì…ë‹ˆë‹¤. ë²ˆì—­ ê²°ê³¼ì˜ ì •í™•ì„±ì´ë‚˜ ì‹ ë¢°ì„±ì„ 100% ë³´ì¥í•˜ì§€ ì•Šìœ¼ë©°, ì´ë¡œ ì¸í•´ ë°œìƒí•œ ë¬¸ì œì— ëŒ€í•´ ì±…ì„ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
                    <p><strong>ì œ3ì¡° (ì„œë¹„ìŠ¤ ì´ìš©)</strong><br>ì‚¬ìš©ìëŠ” ë³¸ ì„œë¹„ìŠ¤ë¥¼ ë¬´ë£Œë¡œ ì´ìš©í•  ìˆ˜ ìˆìœ¼ë©°, ë¶ˆë²•ì ì¸ ëª©ì ìœ¼ë¡œ ì„œë¹„ìŠ¤ë¥¼ ì•…ìš©í•´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤.</p>
                `,
                privacyTitle: "ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨",
                privacyContent: `
                    <p><strong>1. ê°œì¸ì •ë³´ì˜ ìˆ˜ì§‘ ë° ì´ìš© ëª©ì </strong><br>'ì¸ ì¿ ë„¤'ëŠ” ë³„ë„ì˜ íšŒì›ê°€ì…ì„ ë°›ì§€ ì•Šìœ¼ë©°, ê°œì¸ì‹ë³„ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
                    <p><strong>2. ì´ë¯¸ì§€ ë°ì´í„°ì˜ ì²˜ë¦¬</strong><br>ì‚¬ìš©ìê°€ ì—…ë¡œë“œí•œ ë©”ë‰´íŒ ì´ë¯¸ì§€ëŠ” ë²ˆì—­ì„ ìœ„í•´ Google Gemini APIë¡œ ì „ì†¡ë˜ì–´ ì¼ì‹œì ìœ¼ë¡œ ì²˜ë¦¬ëœ í›„ ì¦‰ì‹œ íŒŒê¸°ë©ë‹ˆë‹¤.</p>
                    <p><strong>3. ì¿ í‚¤ ë° ë°ì´í„°</strong><br>ë³¸ ì„œë¹„ìŠ¤ëŠ” ì‚¬ìš©ì ê²½í—˜ í–¥ìƒì„ ìœ„í•´ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë“± ìµœì†Œí•œì˜ ë¸Œë¼ìš°ì € ì €ì¥ì†Œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                `,
                voiceBtnPrefix: "ğŸ”Š ë°œìŒ ë“£ê¸°: ",
                errorNoData: "AIê°€ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.",
                errorRecFailed: "ì¶”ì²œì„ ë°›ì•„ì˜¤ì§€ ëª»í–ˆì–´ìš” ã… ã… "
            },
            en: {
                title: "Tsukune",
                subtitle: "Japanese Menu Master",
                uploadBtn: "ğŸ“‹ï¸ Upload Menu",
                loading: "Tsukune is translating the menu...",
                recBtn: "ğŸ¶ Ask Master for Recommendation âœ¨",
                recBtnLoading: "ğŸ¤” Master is thinking...",
                recBtnRetry: "ğŸ¶ Get Another Recommendation",
                masterTitle: "ğŸ¶ Master's Choice",
                guideTitle: "Don't panic at Japanese Menu!",
                guideDesc: "Tsukune is your personal <strong>interpreter</strong>.",
                step1: "<strong>1. Snap!</strong><br>Take a photo",
                step2: "<strong>2. Whirr~</strong><br>Analyze",
                step3: "<strong>3. Say!</strong><br>Order it",
                scenarioTags: ["ğŸ® Local Izakaya", "ğŸ¢ Yakitori Bar", "ğŸ£ Omakase", "ğŸº All-you-can-drink"],
                tip: "Handwritten or vertical text? No problem!<br>Tsukune reads them like magic. ğŸ‘»",
                navGuide: "ğŸ“– How to use",
                navTips: "ğŸ® Tips",
                navFaq: "â“ FAQ",
                tipsContent: `
                    <div class="tip-box">
                        <h4>1. What is Otoshi (ãŠé€šã—)?</h4>
                        <p>It's a mandatory appetizer served as a table charge. Don't be surprised if you see it on the bill!</p>
                    </div>
                    <div class="tip-box">
                        <h4>2. Tare (Sauce) vs Shio (Salt)</h4>
                        <p>When ordering Yakitori, you'll often be asked to choose. 'Tare' is sweet soy sauce, 'Shio' is salt.</p>
                    </div>
                    <div class="tip-box">
                        <h4>3. Nomihodai (All-you-can-drink)</h4>
                        <p>Look for these characters 'é£²ã¿æ”¾é¡Œ'! It means unlimited drinks for a fixed time. Great value!</p>
                    </div>
                `,
                faqContent: `
                    <div class="faq-item">
                        <div class="faq-q">Q. What is Tsukune?</div>
                        <div class="faq-a">A. It is a free AI web service that translates Japanese menus into English instantly. Just take a photo!</div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-q">Q. Does it read handwriting?</div>
                        <div class="faq-a">A. Yes! Thanks to Gemini AI, it can recognize handwritten and vertical calligraphy with high accuracy.</div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-q">Q. Is my photo saved?</div>
                        <div class="faq-a">A. No. Uploaded images are processed temporarily for translation and are discarded immediately. We respect your privacy.</div>
                    </div>
                `,
                footerRights: "&copy; 2026 Tsukune Menu Translator. All rights reserved.",
                footerNote: "This site uses Gemini API for translation. <br>Translation results may vary depending on image quality.",
                termsBtn: "Terms of Service",
                privacyBtn: "Privacy Policy",
                inquiryBtn: "Contact",
                termsTitle: "Terms of Service",
                termsContent: `
                    <p><strong>Article 1 (Purpose)</strong><br>These terms govern the use of the Japanese menu translation service provided by 'Tsukune'.</p>
                    <p><strong>Article 2 (Nature of Service)</strong><br>This service utilizes AI technology (Google Gemini API). We do not guarantee 100% accuracy of translations and are not responsible for any issues arising from inaccuracies.</p>
                    <p><strong>Article 3 (Use of Service)</strong><br>Users may use this service for free and must not use it for illegal purposes.</p>
                `,
                privacyTitle: "Privacy Policy",
                privacyContent: `
                    <p><strong>1. Data Collection</strong><br>'Tsukune' does not require registration and does not collect personal identification information.</p>
                    <p><strong>2. Image Processing</strong><br>Uploaded menu images are sent to Google Gemini API solely for translation purposes and are not permanently stored.</p>
                    <p><strong>3. Cookies</strong><br>This service may use local storage to enhance user experience.</p>
                `,
                voiceBtnPrefix: "ğŸ”Š Listen: ",
                errorNoData: "AI could not analyze the data.",
                errorRecFailed: "Failed to get recommendation :("
            }
        };

        // í˜„ì¬ ì–¸ì–´ ì„¤ì • (ê¸°ë³¸ê°’: í•œêµ­ì–´)
        let currentLang = 'ko';
        let currentMenuData = null;

        // UI í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function setLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];

            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ í™œì„±í™”
            document.getElementById('btn-ko').classList.toggle('active', lang === 'ko');
            document.getElementById('btn-en').classList.toggle('active', lang === 'en');

            // í…ìŠ¤íŠ¸ êµì²´
            document.getElementById('txt-title').innerText = t.title;
            document.getElementById('txt-subtitle').innerText = t.subtitle;
            document.getElementById('txt-uploadBtn').innerText = t.uploadBtn;
            document.getElementById('txt-loading').innerText = t.loading;
            
            // íƒ­ ë²„íŠ¼ í…ìŠ¤íŠ¸
            document.getElementById('nav-guide').innerText = t.navGuide;
            document.getElementById('nav-tips').innerText = t.navTips;
            document.getElementById('nav-faq').innerText = t.navFaq;

            // ê°€ì´ë“œ ë‚´ìš©
            document.getElementById('txt-guideTitle').innerText = t.guideTitle;
            document.getElementById('txt-guideDesc').innerHTML = t.guideDesc;
            document.getElementById('txt-step1').innerHTML = t.step1;
            document.getElementById('txt-step2').innerHTML = t.step2;
            document.getElementById('txt-step3').innerHTML = t.step3;
            document.getElementById('txt-tip').innerHTML = t.tip;
            
            // íŒ & FAQ ë‚´ìš©
            document.getElementById('tips-content').innerHTML = t.tipsContent;
            document.getElementById('faq-content').innerHTML = t.faqContent;

            // ì‹œë‚˜ë¦¬ì˜¤ íƒœê·¸ ì¬ìƒì„±
            const tagContainer = document.getElementById('txt-scenarioTags');
            tagContainer.innerHTML = '';
            t.scenarioTags.forEach(tag => {
                const span = document.createElement('span');
                span.className = 'tag';
                span.innerText = tag;
                tagContainer.appendChild(span);
            });

            // í‘¸í„° ë° ëª¨ë‹¬
            document.getElementById('txt-footerRights').innerHTML = t.footerRights;
            document.getElementById('txt-footerNote').innerHTML = t.footerNote;
            document.getElementById('txt-termsBtn').innerText = t.termsBtn;
            document.getElementById('txt-privacyBtn').innerText = t.privacyBtn;
            document.getElementById('txt-inquiryBtn').innerText = t.inquiryBtn;
            document.getElementById('modal-terms-title').innerText = t.termsTitle;
            document.getElementById('modal-terms-content').innerHTML = t.termsContent;
            document.getElementById('modal-privacy-title').innerText = t.privacyTitle;
            document.getElementById('modal-privacy-content').innerHTML = t.privacyContent;

            // ì¶”ì²œ ë²„íŠ¼ í…ìŠ¤íŠ¸
            const recBtn = document.getElementById('recommendBtn');
            if (recBtn.style.display !== 'none') {
                recBtn.innerText = t.recBtn;
            }
            
            // ì¶”ì²œ ì˜ì—­ ë¼ë²¨ ì—…ë°ì´íŠ¸
            document.getElementById('recommendationArea').setAttribute('data-label', t.masterTitle);
        }

        // ì´ˆê¸°í™”: í˜ì´ì§€ ë¡œë“œ ì‹œ ì–¸ì–´ ì„¤ì •
        window.onload = function() {
            setLanguage('ko');
        };

        const fileInput = document.getElementById('fileInput');
        const loading = document.getElementById('loading');
        const resultArea = document.getElementById('resultArea');
        const previewContainer = document.getElementById('preview-container');
        const previewImg = document.getElementById('preview-img');

        fileInput.addEventListener('change', handleFileSelect);

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (!file) return;

            loading.style.display = 'block';
            resultArea.innerHTML = '';
            document.getElementById('recommendBtn').style.display = 'none'; 
            document.getElementById('recommendationArea').style.display = 'none'; 
            // ì—…ë¡œë“œ ì‹œ ì •ë³´ ì˜ì—­ì€ ìœ ì§€í•˜ê±°ë‚˜ ìˆ¨ê¸¸ ìˆ˜ ìˆìŒ (ì—¬ê¸°ì„  ìœ ì§€)
            
            const objectUrl = URL.createObjectURL(file);
            previewImg.src = objectUrl;
            previewContainer.style.display = 'block';

            const reader = new FileReader();
            reader.onload = function(e) {
                const base64 = e.target.result.split(',')[1];
                processImageWithFetch(base64);
            };
            reader.readAsDataURL(file);
        }

        async function processImageWithFetch(base64Image) {
            try {
                const analysisResult = await callGemini(base64Image);
                if (!analysisResult) {
                    showError(translations[currentLang].errorNoData);
                    return;
                }
                currentMenuData = analysisResult;
                showResult({ success: true, data: analysisResult });
            } catch (e) {
                showError(e.toString());
            }
        }

        // ğŸ”¥ [ì¡±ë³´] ê³µí†µ ì‚¬ìš©
        const CUSTOM_DICTIONARY = {
            "ã®ã©ãã‚": "ê¸ˆíƒœ / ê³ ê¸‰ ë¶‰ì€ ìƒì„ ",
            "ã‚¢ã‚ªãƒªã‚¤ã‚«": "ë¬´ëŠ¬ì˜¤ì§•ì–´ / ìµœê³ ê¸‰ ì˜¤ì§•ì–´",
            // í•„ìš”í•œ ê²½ìš° ë” ì¶”ê°€
        };

        async function callGemini(base64Image) {
            const dictionaryString = JSON.stringify(CUSTOM_DICTIONARY);

            // ğŸŒ ì–¸ì–´ì— ë”°ë¼ í”„ë¡¬í”„íŠ¸ ë¶„ê¸°
            let systemPrompt = "";
            
            if (currentLang === 'ko') {
                systemPrompt = `
                    ë‹¹ì‹ ì€ ì¼ë³¸ ìš”ë¦¬ 'ë©”ë‰´ ì‚¬ì „'ì…ë‹ˆë‹¤. ë©”ë‰´íŒ ì´ë¯¸ì§€ë¥¼ ë¶„ì„í•˜ì—¬ JSONì„ ë°˜í™˜í•˜ì„¸ìš”.
                    
                    [ê·œì¹™]
                    1. **ì¹´í…Œê³ ë¦¬(ì„¹ì…˜)** êµ¬ë¶„:
                        - ë©”ë‰´íŒì— ì¹´í…Œê³ ë¦¬ê°€ ìˆë‹¤ë©´ "í•œêµ­ì–´(ì¼ë³¸ì–´)" í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•˜ë˜, ì§ì—­ë³´ë‹¤ëŠ” ì‹ë‹¹ ë¬¸ë§¥ì— ë§ëŠ” ìì—°ìŠ¤ëŸ¬ìš´ í•œêµ­ì–´ë¡œ ì˜ì—­í•˜ì„¸ìš”. (ì˜ˆ: 'æšç‰©' -> 'íŠ€ê¹€ë¥˜(æšç‰©)')
                        - ë©”ë‰´íŒì— ì¹´í…Œê³ ë¦¬ê°€ ì—†ë‹¤ë©´ category í•„ë“œë¥¼ ë¹ˆ ë¬¸ìì—´("")ë¡œ ë‘ê±°ë‚˜ ìƒëµí•˜ì„¸ìš”.
                    2. ë°ì´í„° í•„ë“œ:
                        - menu_jp: ì¼ë³¸ì–´ ì›ë¬¸
                        - menu_tr: í•œêµ­ì–´ ë²ˆì—­ (ì¡±ë³´ ë°ì´í„° ìš°ì„  ì ìš©)
                        - voice: í•œêµ­ì–´ ë°œìŒ (ì˜ˆ: ì•¼í‚¤í† ë¦¬)
                        - price: ìˆ«ìë§Œ
                        - desc: ë©”ë‰´ ì„¤ëª… (í•œêµ­ì–´, 20ì ì´ë‚´)
                    3. ì¡±ë³´ ë°ì´í„° ì°¸ê³ : ${dictionaryString}
                    
                    [ì¶œë ¥ ì˜ˆì‹œ]
                    [{"category": "êµ¬ì´ë¥˜(ç„¼ãç‰©)", "items": [{"menu_jp": "ãƒ›ãƒ«ãƒ¢ãƒ³", "menu_tr": "ëŒ€ì°½", "price": "850", "desc": "ì†Œ ë‚´ì¥ êµ¬ì´", "voice": "í˜¸ë¥´ëª¬"}]}]
                    ì‘ë‹µì€ JSON ë°°ì—´ë§Œ ì¶œë ¥.
                `;
            } else {
                // English Prompt
                systemPrompt = `
                    You are a Japanese Menu Dictionary. Analyze the menu image and return JSON.
                    
                    [Rules]
                    1. **Category (Section)**:
                        - If categories exist on the menu, use the format "English(Japanese)" (e.g., Fried Dishes(æšã’ç‰©)). Use context-aware translation appropriate for a restaurant menu rather than literal translation.
                        - If no categories exist, leave the category field empty ("") or omit it.
                    2. Data fields:
                        - menu_jp: Original Japanese text
                        - menu_tr: English Translation
                        - voice: Romanized pronunciation (e.g., Yakitori)
                        - price: Number only
                        - desc: English description (concise, under 15 words)
                    
                    [Output Example]
                    [{"category": "Grilled(ç„¼ãç‰©)", "items": [{"menu_jp": "ãƒ›ãƒ«ãƒ¢ãƒ³", "menu_tr": "Beef Tripe", "price": "850", "desc": "Grilled beef intestine", "voice": "Horumon"}]}]
                    Output ONLY JSON array.
                `;
            }

            const payload = {
                contents: [{
                    parts: [
                        { text: systemPrompt },
                        { inline_data: { mime_type: "image/jpeg", data: base64Image } }
                    ]
                }],
            };

            // ğŸ›‘ [ìˆ˜ì •ë¨] ë””ë²„ê¹…ì„ ìœ„í•œ ì—ëŸ¬ í•¸ë“¤ë§ ê°•í™”
            console.log("ğŸš€ AI ìš”ì²­ ì‹œì‘:", AI_PROXY_URL);
            
            let response;
            try {
                response = await fetch(AI_PROXY_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload)
                });
            } catch (netErr) {
                throw new Error("ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì‹¤íŒ¨ (CORS ë˜ëŠ” ì¸í„°ë„· ë¬¸ì œ): " + netErr.message);
            }

            const responseText = await response.text();
            console.log("ğŸ“¥ ì„œë²„ ì‘ë‹µ ì›ë³¸:", responseText);

            // Worker ë°°í¬ í™•ì¸
            if (responseText.includes("Hello World")) {
                throw new Error("âš ï¸ Workerê°€ ì´ˆê¸° ìƒíƒœì…ë‹ˆë‹¤! Cloudflareì—ì„œ ì½”ë“œë¥¼ ë¶™ì—¬ë„£ê³  'Deploy'ë¥¼ í–ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.");
            }

            // HTTP ìƒíƒœ ì½”ë“œ í™•ì¸
            if (!response.ok) {
                // ğŸ›‘ [UI ê°œì„ ] API Key ê´€ë ¨ ì—ëŸ¬ ì²˜ë¦¬ ê°•í™”
                if (responseText.includes("API Key not found")) {
                     throw new Error("âš ï¸ ì„œë²„ ì„¤ì • ì˜¤ë¥˜: API í‚¤ê°€ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. (Cloudflare Worker ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”)");
                }
                throw new Error(`ì„œë²„ HTTP ì˜¤ë¥˜ (${response.status}): ${responseText}`);
            }

            let json;
            try {
                json = JSON.parse(responseText);
            } catch (e) {
                throw new Error("ì„œë²„ ì‘ë‹µì´ JSONì´ ì•„ë‹™ë‹ˆë‹¤. ì‘ë‹µ ë‚´ìš©: " + responseText.substring(0, 100));
            }

            // ğŸ”¥ Google API ì—ëŸ¬ í•¸ë“¤ë§ (ê°€ì¥ ì¤‘ìš”)
            if (json.error) {
                console.error("Google API Error:", json.error);
                throw new Error(`Google AI ì˜¤ë¥˜: ${json.error.message} (Code: ${json.error.code})`);
            }

            // ë°ì´í„° êµ¬ì¡° í™•ì¸
            if (!json.candidates || !json.candidates[0] || !json.candidates[0].content) {
                console.error("Unexpected JSON structure:", json);
                throw new Error("AI ì‘ë‹µ êµ¬ì¡°ê°€ ì´ìƒí•©ë‹ˆë‹¤. (Safety Filter ë“± ì›ì¸ ê°€ëŠ¥)");
            }

            const text = json.candidates[0].content.parts[0].text;
            const cleanText = text.replace(/```json/g, "").replace(/```/g, "").trim();
            
            return JSON.parse(cleanText);
        }

        async function getRecommendation() {
            if (!currentMenuData) return;

            const btn = document.getElementById('recommendBtn');
            const recArea = document.getElementById('recommendationArea');
            const recContent = document.getElementById('recContent');
            const t = translations[currentLang];

            btn.disabled = true;
            btn.innerHTML = t.recBtnLoading;
            
            let prompt = "";
            if (currentLang === 'ko') {
                prompt = `
                    ì—­í• : ì‹¬ì•¼ì‹ë‹¹ ë§ˆìŠ¤í„°. ë”°ëœ»í•˜ê³  ì¹œì ˆí•œ ë§íˆ¬.
                    ì„ë¬´: ì•„ë˜ ë©”ë‰´ ë°ì´í„° ì¤‘ **ë‹¨ 1ê°œ**ì˜ ìµœê³ ì˜ ë©”ë‰´(ì„¸íŠ¸)ë¥¼ ì¶”ì²œí•´ì¤˜. ì‹¤ì œ ì¡´ì¬í•˜ëŠ” ë©”ë‰´ë§Œ ì‚¬ìš©.
                    ë°ì´í„°: ${JSON.stringify(currentMenuData)}
                    
                    [ì‘ì„± ê·œì¹™ - ì—„ê²© ì¤€ìˆ˜]
                    1. **ì¸ì‚¿ë§:** ì†ë‹˜ì„ ë°˜ê¸°ëŠ” ë”°ëœ»í•œ ì¸ì‚¿ë§ 1ì¤„.
                    2. **ë©”ë‰´ ì¶”ì²œ:** ì¶”ì²œí•˜ëŠ” ë©”ë‰´ëª… 1ê°œ(ë˜ëŠ” ì„¸íŠ¸) + ê°€ê²© í‘œê¸° 1ì¤„. (ì˜ˆ: ğŸ¢ ì¸ ì¿ ë„¤ (350ì—”))
                    3. **ë§ˆë¬´ë¦¬:** ì¶”ì²œ ì´ìœ ì™€ ë§ˆë¬´ë¦¬ ë©˜íŠ¸ 2ì¤„.
                    4. **íŠ¹ìˆ˜ë¬¸ì ê¸ˆì§€:** ë³„í‘œ(*) ì ˆëŒ€ ì‚¬ìš© ê¸ˆì§€.
                    5. í•œêµ­ì–´ë¡œ ì‘ì„±.
                `;
            } else {
                prompt = `
                    Role: Master of 'Midnight Diner'. Warm and friendly tone.
                    Task: Recommend **ONLY ONE** best menu item (or set) from the list below. Use only existing items.
                    Data: ${JSON.stringify(currentMenuData)}
                    
                    [Strict Rules]
                    1. **Greeting:** 1 warm greeting line.
                    2. **Recommendation:** 1 recommended item (or set) + Price line. (e.g., ğŸ¢ Tsukune (350 Yen))
                    3. **Closing:** Reason and closing remark in 2 lines.
                    4. **No Special Chars:** Do NOT use asterisks (*).
                    5. **Speak in English.**
                `;
            }

            const payload = {
                contents: [{ parts: [{ text: prompt }] }]
            };

            try {
                // ğŸ›‘ [ìˆ˜ì •ë¨] ë””ë²„ê¹… ê°•í™”
                const response = await fetch(AI_PROXY_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload)
                });
                
                const responseText = await response.text();

                if (!response.ok) {
                    throw new Error("ì„œë²„ ì—ëŸ¬: " + responseText);
                }
                
                const json = JSON.parse(responseText);
                const text = json.candidates[0].content.parts[0].text;

                recContent.innerText = text;
                recArea.style.display = 'block';
                btn.innerHTML = t.recBtnRetry;
                btn.disabled = false;
                
                recArea.scrollIntoView({ behavior: 'smooth' });

            } catch (e) {
                alert("ì¶”ì²œ ì‹¤íŒ¨ ã… ã… : " + e.message);
                btn.innerHTML = t.recBtn;
                btn.disabled = false;
            }
        }

        function showResult(response) {
            loading.style.display = 'none';
            if (!response.success) { alert("Error: " + response.message); return; }

            const btn = document.getElementById('recommendBtn');
            btn.style.display = 'block';
            btn.innerHTML = translations[currentLang].recBtn;
            
            // ë²ˆì—­ ê²°ê³¼ê°€ ë‚˜ì˜¤ë©´ ê°€ì´ë“œ/íŒ/FAQ ìˆ¨ê¸°ê¸° (ì›í•œë‹¤ë©´ ìœ ì§€ ê°€ëŠ¥)
            document.getElementById('infoNav').style.display = 'none';
            document.querySelectorAll('.info-content').forEach(el => el.style.display = 'none');

            const categories = Array.isArray(response.data) ? response.data : [response.data];
            let html = '';

            categories.forEach(group => {
                if (group.items && group.items.length > 0) {
                    
                    if (group.category && group.category.trim() !== "") {
                        html += `<div class="category-header">${group.category}</div>`;
                    }
                    
                    group.items.forEach(item => {
                        let displayPrice = item.price;
                        if (!isNaN(item.price)) { displayPrice = 'Â¥' + parseInt(item.price).toLocaleString(); }

                        const translatedName = item.menu_tr || item.menu_kr;

                        html += `
                            <div class="card">
                                <div class="card-top">
                                    <div>
                                        <div class="menu-tr">${translatedName}</div>
                                        <div class="menu-jp">${item.menu_jp}</div>
                                    </div>
                                    <div class="price-badge">${displayPrice || ''}</div>
                                </div>
                                <div class="desc">${item.desc}</div>
                                <button class="voice-btn" onclick="speak('${item.menu_jp}')">
                                    ${translations[currentLang].voiceBtnPrefix}"${item.voice}"
                                </button>
                            </div>
                        `;
                    });
                }
            });

            resultArea.innerHTML = html;
        }

        function showError(errorMsg) {
            loading.style.display = 'none';
            alert("âš ï¸ ì˜¤ë¥˜ ë°œìƒ: " + errorMsg);
        }

        function speak(text) {
            if (!text) return;
            window.speechSynthesis.cancel();
            const msg = new SpeechSynthesisUtterance(text);
            msg.rate = 1.0; 
            
            let voices = window.speechSynthesis.getVoices();
            let jaVoice = voices.find(v => v.lang === 'ja-JP' && v.name.includes('Google')) || 
                          voices.find(v => v.lang === 'ja-JP' && v.name.includes('Kyoko')) || 
                          voices.find(v => v.lang === 'ja-JP') ||
                          voices[0];

            if (jaVoice) { msg.voice = jaVoice; msg.lang = 'ja-JP'; }
            else { msg.lang = 'ja-JP'; }

            window.speechSynthesis.speak(msg);
        }

        window.speechSynthesis.onvoiceschanged = function() {
            window.speechSynthesis.getVoices();
        };

        function switchTab(tabName) {
            // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
            document.querySelectorAll('.info-tab-btn').forEach(btn => btn.classList.remove('active'));
            // ì„ íƒëœ ë²„íŠ¼ í™œì„±í™”
            document.getElementById(`nav-${tabName}`).classList.add('active');

            // ëª¨ë“  ì½˜í…ì¸  ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.info-content').forEach(content => content.classList.remove('active'));
            // ì„ íƒëœ ì½˜í…ì¸  ë³´ì´ê¸°
            document.getElementById(`tab-${tabName}`).classList.add('active');
        }

        function openModal(modalId) {
            document.getElementById(modalId).style.display = "flex";
        }
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = "none";
        }
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = "none";
            }
        }
    </script>
</body>
</html>